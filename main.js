/*
@title: Obstacle Avoider
@author: Aditi Ranjan
*/

const player = "p";
const obstacle = "o";
const goal = "g";

setLegend(
  [player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................`],
  [obstacle, bitmap`
................
................
....00000000....
....02222220....
....02222220....
....02222220....
0000022222200000
0222022222202220
0222022222202220
0222022222202220
0222022222202220
0000022222200000
....02222220....
....00000000....
................
................`],
  [goal, bitmap`
................
................
.......000......
......05550.....
.....0555550....
....055555550...
....055555550...
....055555550...
....055555550...
....055555550...
....055555550...
.....0555550....
......05550.....
.......000......
................
................`]
);

setSolids([player, obstacle]);

let level = 0;
const levels = [
  map`
p.....o...o...o.
o...............
...o.o...o..o...
.o..............
.o.....o....o...
....o...........
.o...o....o...o.
.o..o...........
........o.......
..........o.....
..o...o.o..o...o
o...........o.o.
..o...o.....ogo.`
];


setMap(levels[level]);

setPushables({
  [player]: []
});


onInput("w", () => {
  getFirst(player).y -= 1;
});

onInput("a", () => {
  getFirst(player).x -= 1;
});

onInput("s", () => {
  getFirst(player).y += 1;
});

onInput("d", () => {
  getFirst(player).x += 1;
});


afterInput(() => {
  
  const playerPos = getFirst(player);
  const goalPos = getFirst(goal);

  if (playerPos.x === goalPos.x && playerPos.y === goalPos.y) {
    level++;
    
    if (level < levels.length) {
      setMap(levels[level]);
    } else {
      addText("You Win!", { x: 4, y: 4, color: color`3` });
    }
  }
});
